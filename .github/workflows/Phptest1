name: PHP 8 Compatibility Check

on:
  workflow_dispatch: # التشغيل اليدوي فقط لتجنب الإلغاء التلقائي

jobs:
  php-test:
    runs-on: ubuntu-latest
    timeout-minutes: 30 # زيادة وقت التنفيذ
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.2'
        tools: none # تعطيل Composer التلقائي
        
    - name: Download PHPCompatibility مباشرة
      run: |
        mkdir -p vendor/phpcompatibility
        wget https://github.com/PHPCompatibility/PHPCompatibility/archive/refs/heads/master.tar.gz
        tar -xzf master.tar.gz --strip-components=1 -C vendor/phpcompatibility
        rm master.tar.gz
        
    - name: Run Compatibility Check
      run: |
        php vendor/phpcompatibility/bin/phpcs . \
          --standard=PHPCompatibility \
          --runtime-set testVersion 8.0- \
          --ignore=*/vendor/*,*/node_modules/*
